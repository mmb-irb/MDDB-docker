<VirtualHost *:80>

        # MDPosit front end
	<Location / >
   		ProxyPass http://localhost:8080/
   		ProxyPassReverse http://localhost:8080/
	</Location>

        # MDPosit REST API
	<Location /api/ >
                ProxyPass http://localhost:8081/
                ProxyPassReverse http://localhost:8081/
        </Location>

        # VRE lite (anonymous file upload)
	<Location /vre_lite/ >
                ProxyPass http://localhost:8082/vre/
                ProxyPassReverse http://localhost:8082/vre/
        </Location>

        # openVRE (authenticated file upload)
	<Location /vre/ >
                ProxyPass http://localhost:8088/
                ProxyPassReverse http://localhost:8088/
        </Location>

        # Vault (secret management)
	<Location /vault/ >
                ProxyPass http://localhost:8201/
                ProxyPassReverse http://localhost:8201/
        </Location>

        # Keycloak (authentication)
	<Location /keycloak/auth/ >
                ProxyPass http://localhost:9099/auth/
                ProxyPassReverse http://localhost:9099/auth/
        </Location>

	# MinIO WebUI (object storage UI access, recommended to disable it in production)
	<Location /minio/ >
                ProxyPass http://localhost:9001/
                ProxyPassReverse http://localhost:9001/
        </Location>

	# Enable mod_rewrite
        RewriteEngine On
        # WebSocket proxy settings
        RewriteCond %{HTTP:UPGRADE} WebSocket [NC]
        RewriteCond %{HTTP:CONNECTION} Upgrade [NC]
        RewriteRule /minio/(.*) ws://127.0.0.1:9001/$1 [P,L]

        # Redirect /keycloak to /keycloak/auth
        RewriteCond %{REQUEST_URI} ^/keycloak/?$
        RewriteRule ^/keycloak/?$ /keycloak/auth/ [R=301,L]

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

</VirtualHost>

<VirtualHost *:443>

        # MDPosit front end
	<Location / >
   		ProxyPass http://localhost:8080/
   		ProxyPassReverse http://localhost:8080/
	</Location>

        # MDPosit REST API
	<Location /api/ >
                ProxyPass http://localhost:8081/
                ProxyPassReverse http://localhost:8081/
        </Location>

        # VRE lite (anonymous file upload)
	<Location /vre_lite/ >
                ProxyPass http://localhost:8082/vre_lite/
                ProxyPassReverse http://localhost:8082/vre_lite/
        </Location>

        # openVRE (authenticated file upload)
	<Location /vre/ >
                ProxyPass http://localhost:8088/
                ProxyPassReverse http://localhost:8088/
        </Location>

        # Vault (secret management)
	<Location /vault/ >
                ProxyPass http://localhost:8201/
                ProxyPassReverse http://localhost:8201/
        </Location>

        # Keycloak (authentication)
	<Location /keycloak/auth/ >
                ProxyPass http://localhost:9099/auth/
                ProxyPassReverse http://localhost:9099/auth/
        </Location>

	# MinIO WebUI (object storage UI access, recommended to disable it in production)
	<Location /minio/ >
                ProxyPass http://localhost:9001/
                ProxyPassReverse http://localhost:9001/
        </Location>

	# Enable mod_rewrite
        RewriteEngine On
        # WebSocket proxy settings
        RewriteCond %{HTTP:UPGRADE} WebSocket [NC]
        RewriteCond %{HTTP:CONNECTION} Upgrade [NC]
        RewriteRule /minio/(.*) ws://127.0.0.1:9001/$1 [P,L]

        # Redirect /keycloak to /keycloak/auth
        RewriteCond %{REQUEST_URI} ^/keycloak/?$
        RewriteRule ^/keycloak/?$ /keycloak/auth/ [R=301,L]

	#SSLEngine on
	SSLCertificateFile /etc/ssl/certs/www_mddbr_eu_chain.pem
	SSLCertificateKeyFile /etc/ssl/private/www_mddbr_eu.key
	SSLCertificateChainFile /etc/ssl/certs/www_mddbr_eu_chain.pem 

</VirtualHost>